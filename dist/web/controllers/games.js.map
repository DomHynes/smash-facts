{"version":3,"sources":["../../../src/web/controllers/games.js"],"names":["router","get","req","res","find","err","result","render","title","games","payload","findOne","name","params","populate","exec","then","game","_id","facts","forEach","fact","characterNameList","characters","map","char","join","longName","catch","console","log","e","redirect"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;;;kBAEe,YAAM;AACnB,MAAMA,SAAS,sBAAf;;AAEAA,SAAOC,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5B,oBAAMC,IAAN,CAAW,EAAX,EAAe,UAAEC,GAAF,EAAOC,MAAP,EAAkB;AAC/BH,UAAII,MAAJ,CAAW,aAAX,EAA0B,EAAEC,OAAO,OAAT,EAAkBC,OAAOH,MAAzB,EAA1B;AACD,KAFD;AAGD,GAJD;;AAMAN,SAAOC,GAAP,CAAW,QAAX,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;AACjC,QAAIO,UAAU,EAAd;AACA,oBAAMC,OAAN,CAAc,EAACC,MAAMV,IAAIW,MAAJ,CAAWD,IAAlB,EAAd,EAAuCE,QAAvC,CAAgD,YAAhD,EAA8DC,IAA9D,GACGC,IADH,CACS,gBAAQ;AACbN,cAAQO,IAAR,GAAeA,IAAf;AACA,aAAO,gBAAMb,IAAN,CAAW,EAACK,OAAOQ,KAAKC,GAAb,EAAX,EACNJ,QADM,CACG,YADH,EAENA,QAFM,CAEG,OAFH,EAGNA,QAHM,CAGG,cAHH,EAGmBC,IAHnB,EAAP;AAID,KAPH,EAQGC,IARH,CAQS,iBAAS;AACdN,cAAQS,KAAR,GAAgBA,KAAhB;AACAT,cAAQS,KAAR,CAAcC,OAAd,CAAuB,gBAAQ;AAC7BC,aAAKC,iBAAL,GAAyBD,KAAKE,UAAL,CAAgBC,GAAhB,CAAoB;AAAA,iBAAQC,KAAKb,IAAb;AAAA,SAApB,EAAuCc,IAAvC,CAA4C,IAA5C,CAAzB;AACD,OAFD;AAGAvB,UAAII,MAAJ,CAAW,YAAX,EAAyB;AACvBC,eAAOE,QAAQO,IAAR,CAAaU,QADG;AAEvBV,cAAMP,QAAQO,IAFS;AAGvBE,eAAOT,QAAQS;AAHQ,OAAzB;AAKD,KAlBH,EAmBGS,KAnBH,CAmBU,aAAK;AAAEC,cAAQC,GAAR,CAAYC,CAAZ,EAAgB5B,IAAI6B,QAAJ,CAAa,GAAb;AAAmB,KAnBpD;AAoBD,GAtBD;;AAwBA,SAAOhC,MAAP;AACD,C","file":"games.js","sourcesContent":["import { Router } from 'express';\r\nimport games from '../../models/games';\r\nimport facts from '../../models/facts';\r\n\r\nexport default () => {\r\n  const router = Router();\r\n\r\n  router.get('/', (req, res) => {\r\n    games.find({}, ( err, result) => {\r\n      res.render('games/index', { title: 'Games', games: result});\r\n    })\r\n  });\r\n\r\n  router.get('/:name', (req, res) => {\r\n    let payload = {};\r\n    games.findOne({name: req.params.name}).populate('characters').exec()\r\n      .then( game => {\r\n        payload.game = game;\r\n        return facts.find({games: game._id })\r\n        .populate('characters')\r\n        .populate('games')\r\n        .populate('submitted_by').exec()\r\n      })\r\n      .then( facts => {\r\n        payload.facts = facts;\r\n        payload.facts.forEach( fact => {\r\n          fact.characterNameList = fact.characters.map(char => char.name).join(', ');\r\n        });\r\n        res.render('games/view', {\r\n          title: payload.game.longName,\r\n          game: payload.game,\r\n          facts: payload.facts\r\n        });\r\n      })\r\n      .catch( e => { console.log(e); res.redirect('/');});\r\n  })\r\n\r\n  return router;\r\n}\r\n"]}